<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oracle.erpProject.SaleMapper">

	<select id="LsltotalSaleCnt" resultType="int">
		select count(*)
		from sale s, customer c
		WHERE s.cust_no = c.cust_no
		and c.cust_type = 0
	</select>
	<select id="LslsaleAlllist" parameterType="SLSale"
		resultType="SLSale">
	<![CDATA[
		select * 
		from 
		( 
			SELECT rownum rn , a.*
			FROM 
						(
			SELECT
			    s.*,
			    e.EMP_NAME,
			    c.CUST_NAME,
			    CASE
			        WHEN s.s_status = 0 THEN '판매 진행중'
			        WHEN s.s_status = 2 THEN '생산 작업 요청중'
			        WHEN s.s_status = 3 THEN '생산 완료'
			        WHEN s.s_status = 4 THEN '판매 완료'
			        WHEN s.s_status = 5 THEN '수불 완료'
			    END AS sale_status_detail,
			    (
			        SELECT COUNT(DISTINCT sd.P_ITEMCODE)
			        FROM sale_detail sd
			        WHERE sd.CUST_NO = s.CUST_NO
			        AND sd.s_date = s.s_date
			    ) AS productCnt,
			    (
			        SELECT SUM(sd.sd_price * sd.sd_cnt)
			        FROM sale_detail sd
			        WHERE sd.cust_no = s.cust_no
			        AND sd.s_date = s.s_date
			    ) AS totalMoney,
			    (
			        SELECT SUM(sd.sd_cnt)
			        FROM sale_detail sd
			        WHERE sd.CUST_NO = s.CUST_NO
			        AND sd.s_date = s.s_date
			    ) AS totalCnt
			FROM
			    sale s
			    JOIN EMPLOYEE e ON s.EMP_NO = e.EMP_NO
			    JOIN CUSTOMER c ON s.CUST_NO = c.CUST_NO
			WHERE c.cust_type = 0) a
		)
		WHERE rn >=#{start}
		and rn <= #{end}
		]]>
	</select>


	<select id="LslsaleDateSearchtotCnt" parameterType="SLSale" resultType="int">
		SELECT COUNT(*)
		FROM sale s, customer c
		WHERE s.cust_no = c.cust_no
		AND s.s_date = #{s_date}
		AND c.cust_type = 0
	</select>

	<select id="LslsaleDateSearchAllList" parameterType="SLSale" resultType="SLSale">
		SELECT *
   		FROM
    		(
            SELECT rownum rn, a.*
            FROM
                ( SELECT
					s.*,
					e.EMP_NAME,
					c.CUST_NAME,
					 CASE
				        WHEN s.s_status = 0 THEN '판매 진행중'
				        WHEN s.s_status = 2 THEN '생산 작업 요청중'
				        WHEN s.s_status = 3 THEN '생산 완료'
				        WHEN s.s_status = 4 THEN '판매 완료'
				        WHEN s.s_status = 5 THEN '수불 완료'
			    	END AS sale_status_detail,
				 ( 
					SELECT COUNT(DISTINCT sd.P_ITEMCODE)
					FROM sale_detail sd
					WHERE s.CUST_NO = sd.cust_no
				 ) AS productCnt,
				 (
					SELECT SUM(sd.sd_price*sd.sd_price)
					FROM sale_detail sd
					WHERE s.CUST_NO = sd.cust_no
				 ) AS totalMoney,
				(
					SELECT SUM(sd.sd_cnt)
					FROM sale_detail sd
					WHERE s.CUST_NO = sd.cust_no
				) AS totalCnt
				FROM
					sale s
					JOIN EMPLOYEE e ON s.EMP_NO = e.EMP_NO
					JOIN CUSTOMER c ON s.CUST_NO = c.CUST_NO
				WHERE s.s_date = #{s_date}) a
   				 )
   			  WHERE rn BETWEEN #{start} and #{end}
	
	</select>
	
	<select id="LslsaleStatusSearchtotCnt" parameterType="SLSale" resultType="int">
			SELECT COUNT(*)
			FROM sale s
			JOIN customer c ON s.cust_no = c.cust_no
			WHERE c.cust_type = 0
			AND (
			    (s.s_status = #{s_status}) 
			    OR (s.s_status =#{s_status}) 
			    OR (s.s_status = #{s_status}) 
			    OR (s.s_status = #{s_status})
			    OR (s.s_status = #{s_status}) 
			    OR (s.s_status = #{s_status})
			)
	</select>
	
	<select id="LslsaleStatusSearchAllList" parameterType="SLSale" resultType="SLSale">
		SELECT *
	    FROM
	    (
            SELECT rownum rn, a.*
            FROM
                ( SELECT
			s.*,
			e.EMP_NAME,
			c.CUST_NAME,
			CASE
		        WHEN s.s_status = 0 THEN '판매 진행중'
		        WHEN s.s_status = 2 THEN '생산 작업 요청중'
		        WHEN s.s_status = 3 THEN '생산 완료'
		        WHEN s.s_status = 4 THEN '판매 완료'
		        WHEN s.s_status = 5 THEN '수불 완료'
	    	END AS sale_status_detail,
			(
			SELECT COUNT(DISTINCT sd.P_ITEMCODE)
				FROM sale_detail sd
				WHERE s.CUST_NO = sd.cust_no
			) AS productCnt,
			(
			SELECT SUM(sd.sd_price*sd.sd_price)
				FROM sale_detail sd
				WHERE s.CUST_NO = sd.cust_no
			) AS totalMoney,
			(
			SELECT SUM(sd.sd_cnt)
				FROM sale_detail sd
				WHERE s.CUST_NO = sd.cust_no
			) AS totalCnt
		FROM
			sale s
			JOIN EMPLOYEE e ON s.EMP_NO = e.EMP_NO
			JOIN CUSTOMER c ON s.CUST_NO = c.CUST_NO
			AND (
                  (s.s_status = #{s_status}) 
			    OR (s.s_status =#{s_status}) 
			    OR (s.s_status = #{s_status}) 
			    OR (s.s_status = #{s_status})
			    OR (s.s_status = #{s_status}) 
			    OR (s.s_status = #{s_status})
		) ) a
		    )
		    WHERE rn BETWEEN #{start} and #{end}
	</select>

	<select id="LslsaleSearchKeywordtotCnt" parameterType="SLSale" resultType="int">
		select count(*)
		from
		sale s,customer c
		WHERE s.cust_no = c.cust_no
		and c.cust_type = 1
        and c.cust_name  like '%' || #{keyword} || '%'
	</select>
	
	<select id="LslsaleKeywordSearchAllList" parameterType="SLSale" resultType="SLSale">
		  SELECT *
	  FROM
	   (
            SELECT rownum rn, a.*
            FROM
                ( SELECT
					s.*,
					e.EMP_NAME,
					c.CUST_NAME,
				CASE
			        WHEN s.s_status = 0 THEN '판매 진행중'
			        WHEN s.s_status = 2 THEN '생산 작업 요청중'
			        WHEN s.s_status = 3 THEN '생산 완료'
			        WHEN s.s_status = 4 THEN '판매 완료'
			        WHEN s.s_status = 5 THEN '수불 완료'
		    	END AS sale_status_detail,
				(
					SELECT COUNT(DISTINCT sd.P_ITEMCODE)
					FROM sale_detail sd
					WHERE s.CUST_NO = sd.cust_no
				) AS productCnt,
					(
					SELECT SUM(sd.sd_price*sd.sd_price)
					FROM sale_detail sd
					WHERE s.CUST_NO = sd.cust_no
				) AS totalMoney,
				(
					SELECT SUM(sd.sd_cnt)
					FROM sale_detail sd
					WHERE s.CUST_NO = sd.cust_no
				) AS totalCnt
			FROM
			sale s
			JOIN EMPLOYEE e ON s.EMP_NO = e.EMP_NO
			JOIN CUSTOMER c ON s.CUST_NO = c.CUST_NO
			WHERE  c.cust_name  like '%' || #{keyword} || '%' ) a
    )
    WHERE rn BETWEEN #{start} and #{end}
	</select>


</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oracle.erpProject.mkProductMapper">



	<!-- 제품 리스트 조회  -->
	<select id="mkproductList" resultType="mkProduct">
		<![CDATA[
		select * 
		from 
		( 
			SELECT rownum rn , a.*
			FROM 
						(select * from product order by p_itemcode ) a
		)
		WHERE rn >=#{start}
		and rn <= #{end}
		]]>
	</select>
	
	<!-- 제품 상세 조회  -->
	<select id="mkproductDetail" parameterType="mkProduct" resultType="mkProduct">
	<![CDATA[
		select * from product 
		where p_itemcode=${p_itemcode}
		]]>
	</select>
	
	<select id="mktotProduct" resultType="int">
		select Count(*) from product
	</select>
	
<insert id="mkinsertProduct" parameterType="mkProduct">
    INSERT INTO product 
    (p_itemcode, f_id, pro_category, pro_midcategory, p_name, p_content, p_buyprice, p_saleprice, p_regdate, p_fac_gubun,p_image)
    VALUES (product_code_seq.nextval, #{f_id}, #{pro_category}, #{pro_midcategory}, #{p_name}, #{p_content}, #{p_buyprice}, #{p_saleprice}, SYSDATE, #{p_fac_gubun},#{p_image})
</insert>

<select id="productSearchList" parameterType="mkProduct" resultType="mkProduct">
   
    SELECT *
    FROM
    (
            SELECT rownum rn, a.*
            FROM
                (SELECT * FROM product
                <choose>
                    <when test="search == 'p_itemcode'">
                        WHERE p_itemcode LIKE '%' || #{keyword} || '%'    
                    </when>
                    <when test="search == 'p_name'">
                        WHERE p_name LIKE '%' || #{keyword} || '%'    
                    </when>
                    <otherwise>
                        WHERE p_itemcode LIKE '%'   
                    </otherwise>
                </choose>
                ORDER BY p_itemcode
                ) a
    )
    WHERE rn BETWEEN #{start} and #{end}
 
</select>

   
 	<select id="searchedProductTotal"  parameterType="mkProduct"  resultType="int">
		
		SELECT Count(*) FROM product
 		<choose>
 			<when test="search == 'p_itemcode'">
                 WHERE p_itemcode  like '%' || #{keyword} || '%'    
  			</when>
  			<when test="search == 'p_name'">
                 WHERE p_name like '%' || #{keyword} || '%'    
  			</when>
            <otherwise>
                  WHERE p_itemcode   like '%'   
            </otherwise>
        </choose>
		
	</select>  
	<!-- 제품 등록 : 이미지 등록  -->
<!-- 	<insert id="saveProductImagePath" parameterType="mkProduct">
    INSERT INTO product (p_itemcode, f_id, pro_category, pro_midcategory, p_name, p_content, p_buyprice, p_saleprice, p_regdate, p_fac_gubun)
    VALUES (product_code_seq.nextval, #{f_id}, #{pro_category}, #{pro_midcategory}, #{p_name}, #{p_content}, #{p_buyprice}, #{p_saleprice}, SYSDATE, #{p_fac_gubun})
</insert> --> 
	
	<!--  -->
		<update id="mkupdateProduct" parameterType="mkProduct">
			    UPDATE product 
			    SET 
			    <if test="p_image != null">
			    p_image=#{p_image},
			    </if>
			    f_id = #{f_id}, 
			    pro_category = #{pro_category}, 
			    pro_midcategory = #{pro_midcategory}, 
			    p_name = #{p_name}, 
			    p_buyprice = #{p_buyprice}, 
			    p_saleprice = #{p_saleprice}, <!-- 여기에 컴마 추가 -->
			    p_fac_gubun = #{p_fac_gubun},
			    p_isdeleted = #{p_isdeleted}
			    WHERE p_itemcode = #{p_itemcode}
			</update>



</mapper>